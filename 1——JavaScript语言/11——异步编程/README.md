ECMAScript 6 åŠä¹‹åçš„å‡ ä¸ªç‰ˆæœ¬é€æ­¥åŠ å¤§äº†å¯¹å¼‚æ­¥ç¼–ç¨‹æœºåˆ¶çš„æ”¯æŒ:

- ECMAScript 6 æ–°å¢äº†æ­£å¼çš„ Promiseï¼ˆæœŸçº¦ï¼‰å¼•ç”¨ç±»å‹ï¼Œæ”¯æŒä¼˜é›…åœ°å®šä¹‰å’Œç»„ç»‡å¼‚æ­¥é€»è¾‘ã€‚
- æ¥ä¸‹æ¥å‡ ä¸ªç‰ˆæœ¬å¢åŠ äº†ä½¿ç”¨ async å’Œ await å…³é”®å­—å®šä¹‰å¼‚æ­¥å‡½æ•°çš„æœºåˆ¶ã€‚

# ä¸€ï¼Œå¼‚æ­¥ç¼–ç¨‹

åŒæ­¥è¡Œä¸ºå’Œå¼‚æ­¥è¡Œä¸ºçš„å¯¹ç«‹ç»Ÿä¸€æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µã€‚ç‰¹åˆ«æ˜¯åœ¨ JavaScript è¿™ç§å•çº¿ç¨‹äº‹ ä»¶å¾ªç¯æ¨¡å‹ä¸­ï¼ŒåŒæ­¥æ“ä½œä¸å¼‚æ­¥æ“ä½œæ›´æ˜¯ä»£ç æ‰€è¦ä¾èµ–çš„æ ¸å¿ƒæœºåˆ¶ã€‚

## ï¼ˆä¸€ï¼‰åŒæ­¥ä¸å¼‚æ­¥

åŒæ­¥è¡Œä¸ºå¯¹åº”å†…å­˜ä¸­é¡ºåºæ‰§è¡Œçš„å¤„ç†å™¨æŒ‡ä»¤ï¼Œè¿™æ ·çš„æ‰§è¡Œæµç¨‹å®¹æ˜“åˆ†æç¨‹åºåœ¨æ‰§è¡Œåˆ°ä»£ç ä»»æ„ä½ç½®æ—¶çš„çŠ¶æ€ï¼ˆæ¯”å¦‚å˜é‡çš„å€¼ï¼‰ã€‚

> [1â€”â€”åŒæ­¥ç¨‹åº.js](1â€”â€”JavaScriptè¯­è¨€/11â€”â€”å¼‚æ­¥ç¼–ç¨‹/ç¨‹åºæ–‡ä»¶/1â€”â€”åŒæ­¥ç¨‹åº.js)

å¼‚æ­¥è¡Œä¸ºç±»ä¼¼äºç³»ç»Ÿä¸­æ–­ï¼Œå³å½“å‰è¿›ç¨‹å¤–éƒ¨çš„å®ä½“å¯ä»¥è§¦å‘ä»£ç æ‰§è¡Œã€‚

- å¼‚æ­¥æ“ä½œç»å¸¸æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå¼ºåˆ¶è¿›ç¨‹ç­‰å¾…ä¸€ä¸ªé•¿æ—¶é—´çš„æ“ä½œé€šå¸¸æ˜¯ä¸å¯è¡Œçš„ï¼ˆåŒæ­¥æ“ä½œåˆ™å¿…é¡»è¦ç­‰ï¼‰ã€‚
  å¦‚æœä»£ç è¦è®¿é—® ä¸€äº›é«˜å»¶è¿Ÿçš„èµ„æºï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°é•¿æ—¶é—´çš„ç­‰å¾…ã€‚
- æ¯”å¦‚å‘è¿œç¨‹æœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶ç­‰å¾…å“åº”ã€‚

> [2â€”â€”å¼‚æ­¥ç¨‹åº.js](1â€”â€”JavaScriptè¯­è¨€/11â€”â€”å¼‚æ­¥ç¼–ç¨‹/ç¨‹åºæ–‡ä»¶/2â€”â€”å¼‚æ­¥ç¨‹åº.js)

ğŸŒ°ï¼šåœ¨å®šæ—¶å›è°ƒä¸­æ‰§è¡Œä¸€æ¬¡ç®€å•çš„æ•°å­¦è®¡ç®—ï¼š

```JavaScript
let x = 3; 
setTimeout(() => x = x + 4, 1000);
```

ä½†è¿™ä¸€æ¬¡æ‰§è¡Œçº¿ç¨‹ä¸çŸ¥é“ x å€¼ä½•æ—¶ä¼šæ”¹å˜ï¼Œå› ä¸ºè¿™å–å†³äºå›è°ƒä½•æ—¶ä»æ¶ˆæ¯é˜Ÿåˆ—å‡ºåˆ—å¹¶æ‰§è¡Œã€‚

- å›è°ƒæ“ä½œæ˜¯ç”±ç³»ç»Ÿè®¡æ—¶å™¨è§¦å‘çš„ï¼Œè¿™ä¼šç”Ÿæˆä¸€ä¸ªå…¥é˜Ÿæ‰§è¡Œçš„ä¸­æ–­ã€‚åˆ°åº•ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘è¿™ä¸ªä¸­æ–­ï¼Œè¿™å¯¹ JavaScript è¿è¡Œæ—¶æ¥è¯´æ˜¯ä¸€ä¸ªé»‘ç›’ã€‚

è®¾è®¡ä¸€ä¸ªèƒ½å¤ŸçŸ¥é“ x ä»€ä¹ˆæ—¶å€™å¯ä»¥è¯»å–çš„ç³»ç»Ÿæ˜¯éå¸¸éš¾çš„ã€‚JavaScript åœ¨å®ç°è¿™æ ·ä¸€ä¸ªç³»ç»Ÿçš„è¿‡ç¨‹ ä¸­ä¹Ÿç»å†äº†å‡ æ¬¡è¿­ä»£ã€‚

## ï¼ˆäºŒï¼‰ä»¥å¾€çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼

å¼‚æ­¥è¡Œä¸ºæ˜¯ JavaScript çš„åŸºç¡€ï¼Œä½†ä»¥å‰çš„å®ç°ä¸ç†æƒ³ã€‚

åœ¨æ—©æœŸçš„ JavaScript ä¸­ï¼Œåªæ”¯æŒå®šä¹‰å›è°ƒå‡½æ•°æ¥è¡¨æ˜å¼‚æ­¥æ“ä½œå®Œæˆã€‚

- ä¸²è”å¤šä¸ªå¼‚æ­¥æ“ä½œæ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œç»“æœå°±æ˜¯æ·±åº¦åµŒå¥—å¤šå±‚å›è°ƒå‡½æ•°ï¼Œä½†ä¼šé€ æˆ**å›è°ƒåœ°ç‹±**é—®é¢˜ã€‚

ğŸŒ°ï¼šä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼šä½¿ç”¨ `setTimeout` åœ¨ä¸€ç§’é’Ÿä¹‹åæ‰§è¡ŒæŸäº›æ“ä½œ

```JavaScript
function double(value) { 
	setTimeout(
		() => setTimeout(console.log, 0, value * 2) ,
		1000
	); 
} 

double(3); // 6ï¼ˆå¤§çº¦ 1000 æ¯«ç§’ä¹‹åï¼‰
```

**è¿™é‡Œçš„ä»£ç æ²¡ä»€ä¹ˆç¥ç§˜çš„ï¼Œä½†å…³é”®æ˜¯ç†è§£ä¸ºä»€ä¹ˆè¯´å®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼**
1ï¼Œé¦–å…ˆæ˜¯`setTimeout` å¯ä»¥æ¥æ”¶ä¸€ä¸ªåœ¨æŒ‡å®šæ—¶é—´ä¹‹åä¼šè¢«è°ƒåº¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚
2ï¼Œç„¶å JavaScript è¿è¡Œæ—¶ä¼šæŠŠå›è°ƒå‡½æ•°æ¨åˆ°è‡ªå·±çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸Šå»ç­‰å¾…æ‰§è¡Œã€‚æ¨åˆ°é˜Ÿåˆ—ä¹‹åï¼Œå›è°ƒä»€ä¹ˆæ—¶å€™å‡ºåˆ—è¢«æ‰§è¡Œå¯¹ JavaScript ä»£ç å°±å®Œå…¨ä¸å¯è§äº†ã€‚
3ï¼Œdouble() å‡½æ•°åœ¨ `setTimeout` æˆåŠŸè°ƒåº¦å¼‚æ­¥æ“ä½œä¹‹åä¼šç«‹å³é€€å‡ºã€‚

### 1ï¼Œå¼‚æ­¥è¿”å›å€¼

å‡è®¾ setTimeout æ“ä½œä¼šè¿”å›ä¸€ä¸ªæœ‰ç”¨çš„å€¼ï¼Œæœ‰ä»€ä¹ˆå¥½åŠæ³•æŠŠè¿™ä¸ªå€¼ä¼ ç»™éœ€è¦å®ƒçš„åœ°æ–¹ï¼Ÿ

å¹¿æ³›æ¥å—çš„ä¸€ä¸ªç­–ç•¥æ˜¯ç»™å¼‚æ­¥æ“ä½œæä¾›ä¸€ä¸ªå›è°ƒï¼Œè¿™ä¸ªå›è°ƒä¸­åŒ…å«è¦ä½¿ç”¨å¼‚æ­¥è¿”å›å€¼çš„ä»£ç ï¼ˆä½œä¸ºå›è°ƒçš„å‚æ•°ï¼‰ã€‚

> [3â€”â€”ä»¥å¾€çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼šè¿”å›å¼‚æ­¥å€¼](1â€”â€”JavaScriptè¯­è¨€/11â€”â€”å¼‚æ­¥ç¼–ç¨‹/ç¨‹åºæ–‡ä»¶/3â€”â€”ä»¥å¾€çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼šè¿”å›å¼‚æ­¥å€¼.js)



### 2ï¼Œå¤±è´¥å¤„ç†

å¼‚æ­¥æ“ä½œçš„å¤±è´¥å¤„ç†åœ¨å›è°ƒæ¨¡å‹ä¸­ä¹Ÿè¦è€ƒè™‘ï¼Œå› æ­¤è‡ªç„¶å°±å‡ºç°äº†æˆåŠŸå›è°ƒå’Œå¤±è´¥å›è°ƒã€‚

> [4â€”â€”ä»¥å¾€çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼šå¤±è´¥å¤„ç†.](1â€”â€”JavaScriptè¯­è¨€/11â€”â€”å¼‚æ­¥ç¼–ç¨‹/ç¨‹åºæ–‡ä»¶/4â€”â€”ä»¥å¾€çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼šå¤±è´¥å¤„ç†.js)



### 3ï¼ŒåµŒå¥—å¼‚æ­¥å›è°ƒ

å¦‚æœå¼‚æ­¥è¿”å€¼åˆä¾èµ–å¦ä¸€ä¸ªå¼‚æ­¥è¿”å›å€¼ï¼Œé‚£ä¹ˆå›è°ƒçš„æƒ…å†µè¿˜ä¼šè¿›ä¸€æ­¥å˜å¤æ‚ã€‚åœ¨å®é™…çš„ä»£ç ä¸­ï¼Œè¿™å°±è¦æ±‚åµŒå¥—å›è°ƒã€‚

> [5â€”â€”ä»¥å¾€çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼šåµŒå¥—å¼‚æ­¥å›è°ƒ](1â€”â€”JavaScriptè¯­è¨€/11â€”â€”å¼‚æ­¥ç¼–ç¨‹/ç¨‹åºæ–‡ä»¶/5â€”â€”ä»¥å¾€çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼šåµŒå¥—å¼‚æ­¥å›è°ƒ.js)


# äºŒï¼ŒPromise

ä¸€ä¸ªÂ `Promise`Â å¯¹è±¡ä»£è¡¨ä¸€ä¸ªåœ¨è¿™ä¸ª promise è¢«åˆ›å»ºå‡ºæ¥æ—¶ä¸ä¸€å®šå·²çŸ¥å€¼çš„çŠ¶æ€ä»£ç†ã€‚
å®ƒè®©ä½ èƒ½å¤ŸæŠŠå¼‚æ­¥æ“ä½œæœ€ç»ˆçš„æˆåŠŸè¿”å›å€¼æˆ–è€…å¤±è´¥åŸå› å’Œç›¸åº”çš„å¤„ç†ç¨‹åºå…³è”èµ·æ¥ã€‚
è¿™æ ·ä½¿å¾—å¼‚æ­¥æ–¹æ³•å¯ä»¥åƒåŒæ­¥æ–¹æ³•é‚£æ ·è¿”å›å€¼ï¼šå¼‚æ­¥æ–¹æ³•å¹¶ä¸ä¼šç«‹å³è¿”å›æœ€ç»ˆçš„å€¼ï¼Œè€Œæ˜¯ä¼šè¿”å›ä¸€ä¸ªÂ _promise_ï¼Œä»¥ä¾¿åœ¨æœªæ¥æŸä¸ªæ—¶å€™æŠŠå€¼äº¤ç»™ä½¿ç”¨è€…ã€‚

## ï¼ˆä¸€ï¼‰Promise ç®€å²

## ï¼ˆäºŒï¼‰Promise åŸºç¡€

ECMAScript 6 æ–°å¢çš„å¼•ç”¨ç±»å‹ `Promise`ï¼Œå¯ä»¥é€šè¿‡ `new` æ“ä½œç¬¦æ¥å®ä¾‹åŒ–ï¼š

```JavaScript
let p = new Promise(() => {}); 

setTimeout(console.log, 0, p); // Promise
```

- åˆ›å»ºæ–°æœŸçº¦æ—¶éœ€è¦ä¼ å…¥æ‰§è¡Œå™¨ï¼ˆexecutorï¼‰å‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªç©ºå‡½æ•°å¯¹è±¡ã€‚
  setTimeout æ¥å—äº†ä¸‰ä¸ªå‚æ•°ï¼Œè¿™é‡Œä¼šç«‹å³æ‰“å° Promise å®ä¾‹ã€‚

1. functionï¼Œåœ¨åˆ°æœŸæ—¶é—´ (`delay`æ¯«ç§’) ä¹‹åæ‰§è¡Œçš„[å‡½æ•°](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function)ã€‚
2. delayï¼Œå»¶è¿Ÿçš„æ¯«ç§’æ•° (ä¸€ç§’ç­‰äº 1000 æ¯«ç§’)ã€‚å®é™…çš„å»¶è¿Ÿæ—¶é—´å¯èƒ½ä¼šæ¯”æœŸå¾…çš„ (delay æ¯«ç§’æ•°) å€¼é•¿ï¼ŒåŸå› è¯·æŸ¥çœ‹[å®é™…å»¶æ—¶æ¯”è®¾å®šå€¼æ›´ä¹…çš„åŸå› ï¼šæœ€å°å»¶è¿Ÿæ—¶é—´](https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout#%E5%AE%9E%E9%99%85%E5%BB%B6%E6%97%B6%E6%AF%94%E8%AE%BE%E5%AE%9A%E5%80%BC%E6%9B%B4%E4%B9%85%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%9A%E6%9C%80%E5%B0%8F%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%97%B4)ã€‚
3. arg1, ..., argNï¼Œä¸€æ—¦å®šæ—¶å™¨åˆ°æœŸï¼Œå®ƒä»¬ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™ functionã€‚

### 1ï¼ŒçŠ¶æ€æœº

æœŸçº¦æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„å¯¹è±¡ï¼Œå¯èƒ½å¤„äºå¦‚ä¸‹ 3 ç§çŠ¶æ€ä¹‹ä¸€ï¼š

1. å¾…å®šï¼ˆpendingï¼‰ï¼šå°šæœªå¼€å§‹æˆ–è€…æ­£åœ¨æ‰§è¡Œä¸­
2. è§£å†³ï¼ˆresolvedï¼‰ï¼šå·²ç»æˆåŠŸå®Œæˆï¼Œå°±ä¼šæœ‰ä¸€ä¸ªç§æœ‰çš„å†…éƒ¨**è§£å†³å€¼ï¼ˆvalueï¼‰**
3. æ‹’ç»ï¼ˆrejectedï¼‰ï¼šæ²¡æœ‰æˆåŠŸå®Œæˆï¼Œå°±ä¼šæœ‰ä¸€ä¸ªç§æœ‰çš„å†…éƒ¨**æ‹’ç»ç†ç”±ï¼ˆreasonï¼‰**

å¾…å®šæ˜¯ Promise çš„æœ€åˆå§‹çŠ¶æ€ã€‚åœ¨å¾…å®šçŠ¶æ€ä¸‹ï¼ŒPromise å¯ä»¥è½å®šï¼ˆsettledï¼‰ä¸ºä»£è¡¨æˆåŠŸçš„è§£å†³çŠ¶æ€ï¼Œæˆ–è€…ä»£è¡¨å¤±è´¥çš„æ‹’ç»çŠ¶æ€ã€‚
æ— è®ºè½å®šä¸ºå“ªç§çŠ¶æ€éƒ½æ˜¯ä¸å¯é€†çš„ã€‚åªè¦ä»å¾…å®šè½¬æ¢ä¸ºå…‘ç°æˆ–æ‹’ç»ï¼ŒæœŸçº¦çš„çŠ¶æ€å°±ä¸å†æ”¹å˜ã€‚

é‡è¦çš„æ˜¯ï¼ŒPromise çš„çŠ¶æ€æ˜¯ç§æœ‰çš„ï¼Œä¸èƒ½ç›´æ¥é€šè¿‡ JavaScript æ£€æµ‹åˆ°ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ ¹æ®è¯»å–åˆ°çš„ Promise çŠ¶æ€ä»¥åŒæ­¥æ–¹å¼å¤„ç†æœŸçº¦å¯¹è±¡ã€‚
å¦å¤–ï¼ŒPromise çš„çŠ¶æ€ä¹Ÿä¸èƒ½è¢«å¤–éƒ¨ JavaScript ä»£ç ä¿®æ”¹ã€‚è¿™ä¸ä¸èƒ½è¯»å–è¯¥çŠ¶æ€çš„åŸå› æ˜¯ä¸€æ ·çš„ï¼š**Promise æ•…æ„å°†å¼‚æ­¥è¡Œä¸ºå°è£…èµ·æ¥ï¼Œä»è€Œéš”ç¦»å¤–éƒ¨çš„åŒæ­¥ä»£ç ã€‚**

value å’Œ reason éƒ½æ˜¯åŒ…å«åŸå§‹å€¼æˆ–å¯¹è±¡çš„ä¸å¯ä¿®æ”¹çš„å¼•ç”¨ã€‚äºŒè€…éƒ½æ˜¯å¯é€‰çš„ï¼Œè€Œä¸”é»˜è®¤å€¼ä¸º `undefined`ã€‚

### 2ï¼Œé€šè¿‡æ‰§è¡Œå™¨å‡½æ•°æ§åˆ¶ Promise çŠ¶æ€

æ§åˆ¶ Promise çŠ¶æ€çš„è½¬æ¢æ˜¯é€šè¿‡è°ƒç”¨å®ƒçš„ä¸¤ä¸ªå‡½æ•°å‚æ•°å®ç°çš„ï¼š

- `resolve()` ä¼šæŠŠçŠ¶æ€åˆ‡æ¢ä¸ºè§£å†³ã€‚
- `reject()` ä¼šæŠŠçŠ¶æ€åˆ‡æ¢ä¸ºæ‹’ç»ã€‚

```JavaScript
let p1 = new Promise((resolve, reject) => resolve()); setTimeout(console.log, 0, p1); // Promise <resolved>

let p2 = new Promise((resolve, reject) => reject()); setTimeout(console.log, 0, p2); // Promise  <rejected>
```

- è¿™é‡Œä¸ºåœ¨åˆå§‹åŒ–æœŸçº¦æ—¶ï¼Œå°±ç”¨æ‰§è¡Œå™¨å‡½æ•°å·²ç»æ”¹å˜äº†æ¯ä¸ª  Promise çš„çŠ¶æ€ã€‚
- è¿™é‡Œçš„æ‰§è¡Œå™¨å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œè¿™æ˜¯å› ä¸ºæ‰§è¡Œå™¨å‡½æ•°æ˜¯ Promise çš„åˆå§‹åŒ–ç¨‹åºçš„ä¸€éƒ¨åˆ†ã€‚

é€šå¸¸ä¼šä½¿ç”¨ `setTimeout` é€šè¿‡å»¶è¿Ÿè°ƒç”¨çš„æ–¹å¼æ¥æ¨è¿ŸçŠ¶æ€çš„åˆ‡æ¢åŠ¨ä½œï¼š

```JavaScript
// ä½¿ç”¨ `setTimeout` 
let p = new Promise((resolve, reject) => setTimeout(resolve, 1000));

// åœ¨ console.log æ‰“å°æœŸçº¦å®ä¾‹çš„æ—¶å€™ï¼Œè¿˜ä¸ä¼šæ‰§è¡Œè¶…æ—¶å›è°ƒï¼ˆå³ resolve()ï¼‰ 
setTimeout(console.log, 0, p); // Promise <pending>
```

å¦‚æœåœ¨è°ƒç”¨ä¸€ä¸ªæ‰§è¡Œå™¨å‡½æ•°åç»§ç»­ä¿®æ”¹çŠ¶æ€ä¼šé™é»˜å¤±è´¥ï¼š

```JavaScript
let p = new Promise((resolve, reject) => { 
	resolve(); 
	reject(); // æ²¡æœ‰æ•ˆæœ 
}); 

setTimeout(console.log, 0, p); // Promise <resolved> 
```

### 3ï¼ŒPromise.resolve()

Promise å¹¶éä¸€å¼€å§‹å°±å¿…é¡»å¤„äºå¾…å®šçŠ¶æ€ï¼Œç„¶åé€šè¿‡æ‰§è¡Œå™¨å‡½æ•°æ‰èƒ½è½¬æ¢ä¸ºè½å®šçŠ¶æ€ã€‚é€šè¿‡è°ƒç”¨ `Promise.resolve()` é™æ€æ–¹æ³•ï¼Œå¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ªè§£å†³çš„æœŸçº¦ï¼š

```JavaScript
let p1 = new Promise((resolve, reject) => resolve()); 
ç­‰ä»·äºï¼š
let p2 = Promise.resolve();
```

`Promise.resolve()` ä¼šè¿”å›ä¸€ä¸ªè§£å†³å€¼ï¼Œå³å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼š

```JavaScript
setTimeout(console.log, 0, Promise.resolve()); // Promise : undefined 

setTimeout(console.log, 0, Promise.resolve(3)); // Promise : 3

// å¤šä½™çš„å‚æ•°ä¼šå¿½ç•¥ 
setTimeout(console.log, 0, Promise.resolve(4, 5, 6)); // Promise : 4
```

- è¿™ä¸ªé™æ€æ–¹æ³•å¯ä»¥æŠŠä»»ä½•å€¼éƒ½è½¬æ¢ä¸ºä¸€ä¸ª Promiseã€‚

### 4ï¼ŒPromise.reject()

ä¸ Promise.resolve()ç±»ä¼¼ï¼Œ`Promise.reject()` ä¼šå®ä¾‹åŒ–ä¸€ä¸ªæ‹’ç»çš„æœŸçº¦å¹¶æŠ›å‡ºä¸€ä¸ªå¼‚æ­¥é”™è¯¯ï¼š

- è¿™ä¸ªé”™è¯¯ä¸èƒ½é€šè¿‡ `try/catch` æ•è·ï¼Œè€Œåªèƒ½é€šè¿‡æ‹’ç»å¤„ç†ç¨‹åºæ•è·ã€‚

```JavaScript
let p1 = new Promise((resolve, reject) => reject()); 
ç­‰ä»·äºï¼š
let p2 = Promise.reject();
```

`Promise.reject()` ä¼šè¿”å›ä¸€ä¸ªæ‹’ç»ç†ç”±ï¼Œå³å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼š

```JavaScript
let p = Promise.reject(3); 
setTimeout(console.log, 0, p); // Promise : 3 
p.then(null, (e) => setTimeout(console.log, 0, e)); // 3
```


## ï¼ˆä¸‰ï¼‰Promise çš„å®ä¾‹æ–¹æ³•

Promise å®ä¾‹çš„æ–¹æ³•æ˜¯è¿æ¥å¤–éƒ¨åŒæ­¥ä»£ç ä¸å†…éƒ¨å¼‚æ­¥ä»£ç ä¹‹é—´çš„æ¡¥æ¢ã€‚è¿™äº›æ–¹æ³•å¯ä»¥ï¼š

1. è®¿é—®å¼‚æ­¥æ“ä½œè¿”å›çš„æ•°æ®ï¼Œå¤„ç†æœŸçº¦æˆåŠŸå’Œå¤±è´¥çš„ç»“æœ
2. è¿ç»­å¯¹ Promise æ±‚å€¼
3. æ·»åŠ åªæœ‰æœŸçº¦è¿›å…¥ç»ˆæ­¢çŠ¶æ€æ—¶æ‰ä¼šæ‰§è¡Œçš„ä»£ç 

### 1ï¼ŒPromise.prototype.then()

`Promise.prototype.then()`æ˜¯ä¸º Promise å®ä¾‹æ·»åŠ å¤„ç†ç¨‹åºçš„ä¸»è¦æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶æœ€å¤šä¸¤ä¸ªå¯é€‰çš„å‚æ•°ï¼š

- onResolved å¤„ç†ç¨‹åºï¼šåœ¨è¿›å…¥ Resolved çŠ¶æ€æ—¶æ‰§è¡Œã€‚
- onRejected å¤„ç†ç¨‹åºï¼šåœ¨è¿›å…¥ Rejected çŠ¶æ€æ—¶æ‰§è¡Œã€‚

```JavaScript
function onResolved(id) {  
    setTimeout(console.log, 0, id, 'resolved');  
}  
  
function onRejected(id) {  
    setTimeout(console.log, 0, id, 'rejected');  
}  
  
let p1 = new Promise((resolve, reject) => setTimeout(resolve, 3000));  
p1.then(  
    () => onResolved('p1'),  
    () => onRejected('p1')  
);    // p1 resolved  
  
let p2 = new Promise((resolve, reject) => setTimeout(reject, 3000));  
p2.then(  
    () => onResolved('p2'),  
    () => onRejected('p2')  
);  // p2 rejected
```

å¦‚æœæƒ³åªæä¾› onRejected å‚æ•°ï¼Œé‚£å°±è¦åœ¨ onResolved å‚æ•°çš„ä½ç½®ä¸Šä¼ å…¥ `undefined`ï¼š

```JavaScript
function onResolved(id) {  
    setTimeout(console.log, 0, id, 'resolved');  
}  
  
function onRejected(id) {  
    setTimeout(console.log, 0, id, 'rejected');  
}  

let p3 = new Promise((resolve, reject) => setTimeout(resolve, 3000));  
// éå‡½æ•°å¤„ç†ç¨‹åºä¼šè¢«é™é»˜å¿½ç•¥ï¼Œä¸æ¨è  
p3.then('gobbeltygook');  
let p4 = new Promise((resolve, reject) => setTimeout(reject, 3000));  
// ä¸ä¼  onResolved å¤„ç†ç¨‹åºçš„è§„èŒƒå†™æ³•  
p4.then(null, () => onRejected('p4'));
```

`Promise.prototype.then()` æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼š

```JavaScript
let p5 = new Promise(() => {});  
let p6 = p5.then();             // p6 æ˜¯ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡  
setTimeout(console.log, 0, p5); // -> Promise <pending>  
setTimeout(console.log, 0, p6); // -> Promise <pending>  
setTimeout(console.log, 0, p5 === p6);    // -> false
```

è¿™é‡Œçš„æ–° Promise å®ä¾‹ p6 åŸºäº onResovled å¤„ç†ç¨‹åºçš„è¿”å›å€¼æ„å»ºï¼Œå³è¯¥å¤„ç†ç¨‹åºçš„è¿”å›å€¼ä¼šé€šè¿‡ `Promise.resolve()` åŒ…è£…å™¨æ¥ç”Ÿæˆæ–°çš„ Promiseã€‚
å¦‚æœæ²¡æœ‰æä¾›è¿™ä¸ªå¤„ç†ç¨‹åºï¼Œåˆ™ `Promise.resolve()` çš„åŒ…è£…ç»“æœå°±æ˜¯ä¸Šä¸€ä¸ª Promise resolved ä¹‹åçš„å€¼ã€‚
è‹¥è°ƒç”¨ `then()` æ—¶ä¸ä¼  onResovled å¤„ç†ç¨‹åºï¼Œåˆ™åŸæ ·å‘åä¼  Promise å®ä¾‹ï¼š

```JavaScript
let p7 = Promise.resolve("foo");  
let p8 = p7.then();  
setTimeout(console.log, 0, p8); // -> Promise { "foo" }  
// // ç­‰ä»·äºä¸€ä¸‹ä¸‰ç§å†™æ³•  
// let p8 = p7.then(() => undefined);  
// let p8 = p7.then(() => {});  
// let p8 = p7.then(() => Promise.resolve());
```

- å¦‚æœæ²¡æœ‰æ˜¾å¼çš„è¿”å›è¯­å¥ï¼Œåˆ™ `Promise.resolve()` ä¼šåŒ…è£…å‡ºé»˜è®¤çš„è¿”å›å€¼ undefinedã€‚
  å¦‚æœ onResovled æœ‰æ˜¾å¼çš„è¿”å›å€¼ï¼Œåˆ™ `Promise.resolve()` ä¼šåŒ…è£…è¿™ä¸ªå€¼ï¼š

```JavaScript
let p9 =  Promise.resolve('foo');  
let p10 = p9.then(() => 'bar');  
let p11 = p9.then(() => Promise.resolve('bar'));  
setTimeout(console.log, 0, p10); // -> Promise <resolved>: bar  
setTimeout(console.log, 0, p11); // -> Promise <resolved>: bar
```

å¦‚æœ onResovled æŠ›å‡ºå¼‚å¸¸ä¼šè¿”å› rejected Promiseï¼š

```JavaScript
let p9 =  Promise.resolve('foo'); 
let p12 = p9.then(() => { throw 'baz'; });  
// Uncaught (in promise) baz  
setTimeout(console.log, 0, p12);  
/* è¾“å‡º  
[UnhandledPromiseRejection: This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with  
 .catch(). The promise rejected with the reason "baz".] {  code: 'ERR_UNHANDLED_REJECTION'}  
*/
```

è¿”å›é”™è¯¯å€¼ä¸ä¼šè§¦å‘ä¸Šé¢çš„ reject è¡Œä¸ºï¼Œè€Œæ˜¯åŒä¼šæŠŠé”™è¯¯å¯¹è±¡åŒ…è£…åœ¨ä¸€ä¸ª rejected Promise ä¸­ï¼š

```JavaScript
let p13 = p9.then(() => Error('qux'));  
setTimeout(console.log, 0, p13); // Promise <resolved>: Error: qux
```

onRejected å¤„ç†ç¨‹åºè¿”å›çš„å€¼ä¹Ÿä¼šè¢« `Promise.resolve()` åŒ…è£…ã€‚å› ä¸º onRejected å¤„ç†ç¨‹åºçš„ä»»åŠ¡å°±æ˜¯æ•è·å¼‚æ­¥é”™è¯¯ï¼Œæ‰€ä»¥å®ƒåœ¨æ•è·é”™è¯¯åä¸æŠ›å‡ºå¼‚å¸¸è€Œæ˜¯åŒæ ·è¿”å›ä¸€ä¸ª rejected Promiseï¼š

```JavaScript
let p14 = Promise.reject('foo')  
let p15 = p14.then(null, () => Error('qux'));  
setTimeout(console.log, 0, p15); // Promise <resolved>: Error: qux
```

> [7â€”â€”Promise.thenæ–¹æ³•](1â€”â€”JavaScriptè¯­è¨€/11â€”â€”å¼‚æ­¥ç¼–ç¨‹/ç¨‹åºæ–‡ä»¶/7â€”â€”Promise.thenæ–¹æ³•.js)


### 2ï¼ŒPromise.prototype.catch()

`Promise.prototype.catch()` æ–¹æ³•ç”¨äºç»™ Promise æ·»åŠ æ‹’ç»å¤„ç†ç¨‹åºã€‚è¿™ä¸ªæ–¹æ³•åªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼š

- onRejected å¤„ç†ç¨‹åºã€‚

```JavaScript
let p = Promise.reject();  
let onRejected = function (e) {  
    setTimeout(console.log, 0, 'rejected');  
};  
  
// è¿™ä¸¤ç§æ·»åŠ æ‹’ç»å¤„ç†ç¨‹åºçš„æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼š  
p.then(null, onRejected); // rejected  
p.catch(onRejected); // rejected
```

`Promise.prototype.catch()` åŒæ ·è¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ï¼š

- è¿”å› Promise å®ä¾‹çš„è¡Œä¸ºä¸ `Promise.prototype.then()` çš„ onRejected å¤„ç†ç¨‹åºæ˜¯ä¸€æ ·çš„ã€‚

```JavaScript
let p1 = new Promise(() => {});  
let p2 = p1.catch();  
setTimeout(console.log, 0, p1); // Promise <pending>  
setTimeout(console.log, 0, p2); // Promise <pending>  
setTimeout(console.log, 0, p1 === p2); // false
```

> [8â€”â€”Promise.catch()æ–¹æ³•](1â€”â€”JavaScriptè¯­è¨€/11â€”â€”å¼‚æ­¥ç¼–ç¨‹/ç¨‹åºæ–‡ä»¶/8â€”â€”Promise.catch()æ–¹æ³•.js)


# ä¸‰ï¼Œå¼‚æ­¥å‡½æ•°

## ï¼ˆä¸€ï¼‰

## ï¼ˆäºŒï¼‰

## ï¼ˆä¸‰ï¼‰

## ï¼ˆå››ï¼‰

# å››ï¼Œ

# äº”ï¼Œ

# å…­ï¼Œ

# ä¸ƒï¼Œ

# å…«ï¼Œ

# ä¹ï¼Œ

# åï¼Œ

# åä¸€ï¼Œ

## ï¼ˆä¸€ï¼‰

## ï¼ˆäºŒï¼‰

## ï¼ˆä¸‰ï¼‰

## ï¼ˆå››ï¼‰

## ï¼ˆäº”ï¼‰

## ï¼ˆå…­ï¼‰

## ï¼ˆä¸ƒï¼‰

## ï¼ˆå…«ï¼‰

## ï¼ˆä¹ï¼‰

## ï¼ˆåï¼‰

## ï¼ˆåä¸€ï¼‰

### 1ï¼Œ

### 2ï¼Œ

### 3ï¼Œ

### 4ï¼Œ

### 5ï¼Œ

### 6ï¼Œ

### 7ï¼Œ

### 8ï¼Œ

#### ï¼ˆ1ï¼‰

#### ï¼ˆ2ï¼‰

#### ï¼ˆ3ï¼‰

#### ï¼ˆ4ï¼‰

#### ï¼ˆ5ï¼‰

#### ï¼ˆ6ï¼‰

#### ï¼ˆ7ï¼‰

#### ï¼ˆ8ï¼‰
